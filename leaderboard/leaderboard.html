<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width" , initial-scale="1.0">
    <title> Leaderboard </title>
    <!-- The link below is used for formatting the website and uses a CDN to get the framework for building the website. -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <style>
        .arrow {
            border: solid white;
            border-width: 0 3px 3px 0;
            display: inline-block;
            padding: 3px;
        }

        .up {
            transform: rotate(-135deg);
            -webkit-transform: rotate(-135deg);
        }

        .down {
            transform: rotate(45deg);
            -webkit-transform: rotate(45deg);
        }
    </style>
</head>

<body>

    <div class="container text-center overflow-auto">
        <table class="table table-striped table-hover table-light">
            <thead class="table-dark">
                <th>Rank</th>
                <th>Username <i class="arrow up" id="username_up"></i> <i class="arrow down" id="username_down"></i>
                </th>
                <th>Total Words Typed <i class="arrow up" id="total_words_typed_up"></i> <i class="arrow down"
                        id="total_words_typed_down"></i></th>
                <th>Total Characters Typed <i class="arrow up" id="total_characters_typed_up"></i> <i class="arrow down"
                        id="total_characters_typed_down"></i></th>
                <th>Average WPM <i class="arrow up" id="avg_WPM_up"></i> <i class="arrow down" id="avg_WPM_down"></i>
                </th>
                <th>Average CPM <i class="arrow up" id="avg_CPM_up"></i> <i class="arrow down" id="avg_CPM_down"></i>
                </th>
                <th>Accuracy <i class="arrow up" id="accuracy_up"></i> <i class="arrow down" id="accuracy_down"></i>
                </th>
                <th>Lifetime Accuracy <i class="arrow up" id="lifetime_accuracy_up"></i> <i class="arrow down"
                        id="lifetime_accuracy_down"></i></th>
                <th>Total Completed Runs <i class="arrow up" id="total_completed_runs_up"></i> <i class="arrow down"
                        id="total_completed_runs_down"></i></th>
                <th>Total Time Spent Typing <i class="arrow up" id="total_time_spent_typing_up"></i> <i
                        class="arrow down" id="total_time_spent_typing_down"></i></th>
            </thead>
            <tbody id="data_table"></tbody>
        </table>
    </div>

    <script type="module">

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCfqETPecXz44bqT_d5hgQAFbejf4isfIk",
            authDomain: "coderacer-4d354.firebaseapp.com",
            databaseURL: "https://coderacer-4d354-default-rtdb.firebaseio.com",
            projectId: "coderacer-4d354",
            storageBucket: "coderacer-4d354.appspot.com",
            messagingSenderId: "300760585108",
            appId: "1:300760585108:web:f1841e34b255daf97fb581"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        import {
            getDatabase, ref, onValue, child, get,
            query, limitToFirst, limitToLast, orderByChild,
            orderByValue, orderByKey, startAt, startAfter,
            endAt, endBefore, equalTo
        }
            from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

        const db = getDatabase();

        // Function for adding one record to the table (td = table data, tr = table row, th = table header)

        var rankNum = 0;
        var tbody = document.getElementById('data_table');

        function AddItemToTable(username, total_words_typed, total_characters_typed, avg_WPM, avg_CPM,
            accuracy, lifetime_accuracy, total_completed_runs, total_time_spent_typing) {

            let trow = document.createElement("tr");
            let td1 = document.createElement('td');
            let td2 = document.createElement('td');
            let td3 = document.createElement('td');
            let td4 = document.createElement('td');
            let td5 = document.createElement('td');
            let td6 = document.createElement('td');
            let td7 = document.createElement('td');
            let td8 = document.createElement('td');
            let td9 = document.createElement('td');
            let td10 = document.createElement('td');

            td1.innerHTML = ++rankNum;
            td2.innerHTML = username;
            td3.innerHTML = total_words_typed;
            td4.innerHTML = total_characters_typed;
            td5.innerHTML = avg_WPM;
            td6.innerHTML = avg_CPM;
            td7.innerHTML = accuracy;
            td8.innerHTML = lifetime_accuracy;
            td9.innerHTML = total_completed_runs;
            td10.innerHTML = total_time_spent_typing;

            trow.appendChild(td1);
            trow.appendChild(td2);
            trow.appendChild(td3);
            trow.appendChild(td4);
            trow.appendChild(td5);
            trow.appendChild(td6);
            trow.appendChild(td7);
            trow.appendChild(td8);
            trow.appendChild(td9);
            trow.appendChild(td10);

            tbody.appendChild(trow);
        }

        // References

        var username_up = document.getElementById('username_up');
        var username_down = document.getElementById('username_down');
        var total_words_typed_up = document.getElementById('total_words_typed_up');
        var total_words_typed_down = document.getElementById('total_words_typed_down');
        var total_characters_typed_up = document.getElementById('total_characters_typed_up');
        var total_characters_typed_down = document.getElementById('total_characters_typed_down');
        var avg_WPM_up = document.getElementById('avg_WPM_up');
        var avg_WPM_down = document.getElementById('avg_WPM_down');
        var accuracy_up = document.getElementById('accuracy_up');
        var accuracy_down = document.getElementById('accuracy_down');
        var lifetime_accuracy_up = document.getElementById('lifetime_accuracy_up');
        var lifetime_accuracy_down = document.getElementById('lifetime_accuracy_down');
        var total_completed_runs_up = document.getElementById('total_completed_runs_up');
        var total_completed_runs_down = document.getElementById('total_completed_runs_down');
        var total_time_spent_typing_up = document.getElementById('total_time_spent_typing_up');
        var total_time_spent_typing_down = document.getElementById('total_time_spent_typing_down');

        // Adding all items to the leaderboard

        function AddAllItemsToLeaderboard(UsersList) {
            var users = [];

            // Inital state of data from Firebase

            rankNum = 0;
            tbody.innerHTML = "";
            UsersList.forEach(element => {
                AddItemToTable(element.username, element.total_words_typed, element.total_characters_typed, element.avg_WPM, element.avg_CPM,
                    element.accuracy, element.lifetime_accuracy, element.total_completed_runs, element.total_time_spent_typing)
            });

            // Ascending order for username

            username_up.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('username'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users);
                })
            })

            // Descending order for username

            username_down.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('username'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users.reverse());
                })
            })

            // Ascending order for total words typed

            total_words_typed_up.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('total_words_typed'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users);
                })
            })

            // Descending order for total words typed

            total_words_typed_down.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('total_words_typed'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users.reverse());
                })
            })

            // Ascending order for total characters typed

            total_characters_typed_up.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('total_characters_typed'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users);
                })
            })

            // Descending order for total characters typed

            total_characters_typed_down.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('total_characters_typed'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users.reverse());
                })
            })

            // Ascending order for avg_WPM

            avg_WPM_up.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('avg_WPM'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users);
                })
            })

            // Descending order for avg_WPM

            avg_WPM_down.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('avg_WPM'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users.reverse());
                })
            })

            // Ascending order for avg_CPM

            avg_CPM_up.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('avg_CPM'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users);
                })
            })

            // Descending order for avg_CPM

            avg_CPM_down.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('avg_CPM'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users.reverse());
                })
            })

            // Ascending order for accuracy

            accuracy_up.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('accuracy'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users);
                })
            })

            // Descending order for accuracy

            accuracy_down.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('accuracy'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users.reverse());
                })
            })

            // Ascending order for lifetime accuracy

            lifetime_accuracy_up.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('lifetime_accuracy'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users);
                })
            })

            // Descending order for lifetime accuracy

            lifetime_accuracy_down.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('lifetime_accuracy'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users.reverse());
                })
            })

            // Ascending order for total completed runs

            total_completed_runs_up.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('total_completed_runs'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users);
                })
            })

            // Descending order for total completed runs

            total_completed_runs_down.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('total_completed_runs'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users.reverse());
                })
            })

            // Ascending order for total time spent typing

            total_time_spent_typing_up.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('total_time_spent_typing'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users);
                })
            })

            // Descending order for total time spent typing

            total_time_spent_typing_down.addEventListener('click', () => {
                const dbRef = query(ref(db, 'UsersList'), orderByChild('total_time_spent_typing'), limitToFirst(15));

                onValue(dbRef, (snapshot) => {
                    snapshot.forEach(childsnapshot => {
                        users.push(childsnapshot.val());
                    });

                    AddAllItemsToLeaderboard(users.reverse());
                })
            })
        }

        // Getting all of the data from Firebase

        function GetAllDataInRealtime() {
            // const dbRef = ref(db, 'UsersList/');
            const dbRef = query(ref(db, 'UsersList'));

            // Unsorted Table

            onValue(dbRef, (snapshot) => {
                var users = [];
                snapshot.forEach(childsnapshot => {
                    users.push(childsnapshot.val());
                });

                AddAllItemsToLeaderboard(users);
            })
        }

        window.onload = GetAllDataInRealtime();

    </script>
</body>

</html>